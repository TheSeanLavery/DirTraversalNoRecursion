<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dir Traversal Report</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 20px; }
      .grid { display: grid; grid-template-columns: 1fr; gap: 24px; }
      @media (min-width: 900px) { .grid { grid-template-columns: 1fr 1fr; } }
      canvas { width: 100%; height: 360px; }
      table { border-collapse: collapse; width: 100%; }
      th, td { padding: 8px 10px; border-bottom: 1px solid #ddd; text-align: right; }
      th:first-child, td:first-child { text-align: left; }
      code { background: #f5f5f5; padding: 2px 4px; border-radius: 4px; }
      h2, h3 { margin: 12px 0 6px; }
      p { margin: 6px 0 12px; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  </head>
  <body>
    <h2>Directory Traversal Report</h2>
    <p>
      Generated at <code>2025-08-20T20:37:31.534Z</code>, runs per scenario: <code>5</code> Â·
      Repository: <a href="https://github.com/TheSeanLavery/DirTraversalNoRecursion" target="_blank" rel="noopener noreferrer">https://github.com/TheSeanLavery/DirTraversalNoRecursion</a>
    </p>
    <h3>What this demonstrates</h3>
    <p>
      This report compares a <b>non-recursive</b> directory traversal with a <b>recursive</b> baseline.
      The non-recursive implementation uses an explicit work queue with a pool of async agents (concurrency = <code>16</code>),
      which makes it stack-overflow proof regardless of depth and enables controlled parallelism.
      The charts and table below show that the non-recursive approach is <b>comparable</b> and often
      <b>slightly faster</b> than a straightforward recursive traversal for these scenarios.
    </p>
    <h3>Testing methodology</h3>
    <p>
      For each scenario we synthesize a deterministic directory tree targeting a given number of subdirectories
      (included targets: <code>10, 100, 1,000, 10,000, 100,000</code>; skipped: <code>1,000,000</code>), up to 10 levels deep with a few small files per directory.
      A seeded pseudo-random generator controls branching and file counts so the structure is reproducible.
      In every run, both implementations traverse the <b>same</b> tree instance and invoke a no-op <code>onFile</code> for each file.
      We measure traversal time with high-resolution timers and aggregate <b>mean</b>, <b>median</b>, and <b>p95</b> statistics across runs.
      Each temporary tree is deleted after timing to keep the environment clean.
    </p>
    <h3>Interpreting the charts</h3>
    <p>
      The left chart compares <b>mean</b> durations; the right chart compares <b>median</b> durations across scenarios.
      Green represents <b>Non-Recursive</b>, blue represents <b>Recursive</b>. Numeric values are rendered above bars/points for readability.
      Because the directory structure per scenario and iteration is generated using a <b>deterministic seeded RNG</b>,
      results are <b>reproducible</b> and <b>fair</b> across both methods in each run. Absolute values will remain stable for a given report.
    </p>
    <div class="grid">
      <div>
        <h3>Mean duration (ms) by scenario</h3>
        <canvas id="meanChart"></canvas>
      </div>
      <div>
        <h3>Median duration (ms) by scenario</h3>
        <canvas id="medianChart"></canvas>
      </div>
    </div>
    <h3>Summary</h3>
    <table id="summaryTable">
      <thead>
        <tr><th>Target Dirs</th><th>NR mean</th><th>NR median</th><th>NR p95</th><th>R mean</th><th>R median</th><th>R p95</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <script>
      const REPORT = {"generatedAt":"2025-08-20T20:37:31.534Z","runsPerScenario":5,"scenarios":[{"targetDirs":10,"skipped":false,"runs":[{"iteration":0,"nonRecursive":{"ms":2.0180830000000007,"files":6},"recursive":{"ms":1.4150840000000002,"files":6}},{"iteration":1,"nonRecursive":{"ms":0.6546249999999958,"files":4},"recursive":{"ms":1.4299160000000057,"files":4}},{"iteration":2,"nonRecursive":{"ms":0.8619999999999948,"files":4},"recursive":{"ms":1.5197499999999948,"files":4}},{"iteration":3,"nonRecursive":{"ms":0.47587500000000205,"files":6},"recursive":{"ms":0.8532500000000027,"files":6}},{"iteration":4,"nonRecursive":{"ms":0.5880419999999944,"files":4},"recursive":{"ms":0.7483749999999958,"files":4}}],"summary":{"nonRecursive":{"mean":0.9197249999999976,"median":0.6546249999999958,"p95":2.0180830000000007},"recursive":{"mean":1.1932749999999999,"median":1.4150840000000002,"p95":1.5197499999999948}}},{"targetDirs":100,"skipped":false,"runs":[{"iteration":0,"nonRecursive":{"ms":3.4869999999999948,"files":8},"recursive":{"ms":8.688874999999996,"files":8}},{"iteration":1,"nonRecursive":{"ms":3.7092910000000074,"files":6},"recursive":{"ms":7.7086670000000055,"files":6}},{"iteration":2,"nonRecursive":{"ms":3.8585000000000065,"files":10},"recursive":{"ms":5.9743330000000014,"files":10}},{"iteration":3,"nonRecursive":{"ms":2.9555000000000007,"files":8},"recursive":{"ms":5.7929169999999885,"files":8}},{"iteration":4,"nonRecursive":{"ms":2.858292000000006,"files":9},"recursive":{"ms":7.371332999999993,"files":9}}],"summary":{"nonRecursive":{"mean":3.373716600000003,"median":3.4869999999999948,"p95":3.8585000000000065},"recursive":{"mean":7.107224999999997,"median":7.371332999999993,"p95":8.688874999999996}}},{"targetDirs":1000,"skipped":false,"runs":[{"iteration":0,"nonRecursive":{"ms":30.654750000000007,"files":4},"recursive":{"ms":76.76287500000004,"files":4}},{"iteration":1,"nonRecursive":{"ms":26.9735,"files":7},"recursive":{"ms":71.80091700000003,"files":7}},{"iteration":2,"nonRecursive":{"ms":25.183875000000057,"files":11},"recursive":{"ms":64.90420900000004,"files":11}},{"iteration":3,"nonRecursive":{"ms":21.719208999999978,"files":11},"recursive":{"ms":60.109249999999975,"files":11}},{"iteration":4,"nonRecursive":{"ms":21.922833999999966,"files":4},"recursive":{"ms":60.09458399999994,"files":4}}],"summary":{"nonRecursive":{"mean":25.290833600000003,"median":25.183875000000057,"p95":30.654750000000007},"recursive":{"mean":66.73436699999999,"median":64.90420900000004,"p95":76.76287500000004}}},{"targetDirs":10000,"skipped":false,"runs":[{"iteration":0,"nonRecursive":{"ms":243.6324999999997,"files":7464},"recursive":{"ms":708.4810420000003,"files":7464}},{"iteration":1,"nonRecursive":{"ms":269.2123329999995,"files":7538},"recursive":{"ms":708.8829589999996,"files":7538}},{"iteration":2,"nonRecursive":{"ms":249.89199999999983,"files":7490},"recursive":{"ms":705.4137910000009,"files":7490}},{"iteration":3,"nonRecursive":{"ms":269.38945799999965,"files":7573},"recursive":{"ms":1022.8895000000011,"files":7573}},{"iteration":4,"nonRecursive":{"ms":255.2403749999994,"files":7394},"recursive":{"ms":904.0822499999995,"files":7394}}],"summary":{"nonRecursive":{"mean":257.4733331999996,"median":255.2403749999994,"p95":269.38945799999965},"recursive":{"mean":809.9499084000003,"median":708.8829589999996,"p95":1022.8895000000011}}},{"targetDirs":100000,"skipped":false,"runs":[{"iteration":0,"nonRecursive":{"ms":7709.010541,"files":52354},"recursive":{"ms":7079.164792000003,"files":52354}},{"iteration":1,"nonRecursive":{"ms":6582.907833000005,"files":52553},"recursive":{"ms":7979.5198329999985,"files":52553}},{"iteration":2,"nonRecursive":{"ms":6461.152625000002,"files":52446},"recursive":{"ms":7195.275875000007,"files":52446}},{"iteration":3,"nonRecursive":{"ms":7011.272708000004,"files":52306},"recursive":{"ms":7624.043750000012,"files":52306}},{"iteration":4,"nonRecursive":{"ms":6710.484375,"files":52580},"recursive":{"ms":8149.6606249999895,"files":52580}}],"summary":{"nonRecursive":{"mean":6894.965616400002,"median":6710.484375,"p95":7709.010541},"recursive":{"mean":7605.532975000002,"median":7624.043750000012,"p95":8149.6606249999895}}},{"targetDirs":1000000,"skipped":true,"reason":"target too large for default run (use --allow-huge)","runs":[],"summary":null}]};
      const scenarios = REPORT.scenarios.filter(s => !s.skipped);
      const labels = scenarios.map(s => s.targetDirs.toLocaleString());
      const nrMean = scenarios.map(s => s.summary.nonRecursive.mean);
      const rMean = scenarios.map(s => s.summary.recursive.mean);
      const nrMed = scenarios.map(s => s.summary.nonRecursive.median);
      const rMed = scenarios.map(s => s.summary.recursive.median);

      // Register DataLabels plugin
      Chart.register(ChartDataLabels);
      const sharedDatalabels = {
        color: '#111',
        anchor: 'end',
        align: 'top',
        clamp: true,
        formatter: (v) => (typeof v === 'number' ? v.toFixed(2) : v)
      };

      const ctx1 = document.getElementById('meanChart');
      new Chart(ctx1, {
        type: 'bar',
        data: {
          labels,
          datasets: [
            { label: 'Non-Recursive (mean)', backgroundColor: '#4CAF50', data: nrMean },
            { label: 'Recursive (mean)', backgroundColor: '#2196F3', data: rMean }
          ]
        },
        options: { 
          responsive: true,
          scales: { y: { beginAtZero: true } },
          plugins: { datalabels: sharedDatalabels }
        }
      });

      const ctx2 = document.getElementById('medianChart');
      new Chart(ctx2, {
        type: 'line',
        data: {
          labels,
          datasets: [
            { label: 'Non-Recursive (median)', borderColor: '#4CAF50', data: nrMed },
            { label: 'Recursive (median)', borderColor: '#2196F3', data: rMed }
          ]
        },
        options: { 
          responsive: true,
          scales: { y: { beginAtZero: true } },
          plugins: { datalabels: Object.assign({}, sharedDatalabels, { align: 'top', anchor: 'end' }) }
        }
      });

      const tbody = document.querySelector('#summaryTable tbody');
      for (const s of scenarios) {
        const tr = document.createElement('tr');
        const c = s.summary;
        tr.innerHTML = '<td>' + s.targetDirs.toLocaleString() + '</td>' +
          '<td>' + c.nonRecursive.mean.toFixed(2) + '</td>' +
          '<td>' + c.nonRecursive.median.toFixed(2) + '</td>' +
          '<td>' + c.nonRecursive.p95.toFixed(2) + '</td>' +
          '<td>' + c.recursive.mean.toFixed(2) + '</td>' +
          '<td>' + c.recursive.median.toFixed(2) + '</td>' +
          '<td>' + c.recursive.p95.toFixed(2) + '</td>';
        tbody.appendChild(tr);
      }
    </script>
  </body>
</html>